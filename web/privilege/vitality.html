<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    @@include('html-head.html')
    <title>兴發 - 新春红包</title>
    <link rel="stylesheet" href="/style/css/vitality.css">
    <script type="text/javascript" src="/style/js/lodash.js"></script>
</head>
<body>
@@include('header.html')
<div class="vitality-container">
    <div class="vitality-banner">
        <img src="/style/img/promotion/vitality/vitality_banner.png" alt="" srcset="">
    </div>
    <div class="vitality-content">
        <div class="vitality-package">
            <div class="package-img">
                <section class="vitality-count">
                    <!-- <span>01</span>
                    <b>日</b>                                     
                    <span>12</span>
                    <b>时</b>
                    <span>52</span>
                    <b>分</b> 
                    <span>30</span> 
                    <b>秒</b> -->
                </section>
                <section class="package-content">
                    <img class="red-bottom" src="/style/img/promotion/vitality/vitality_bag_bg.png" alt="" srcset="">
                    <img class="red-top" src="/style/img/promotion/vitality/vitality_bag.png" alt="" srcset="">
                    <p class="row-gift">
                        <img class="red-gft" src="/style/img/promotion/vitality/open_award.png" alt="" srcset="">   
                    </p>  
                    <section class="red-money">888元</section>                  
                </section>
            </div>
            <div class="package-table">
                <h3>领取记录</h3>
                <div class="draw-record"> 
                    <table>
                        <thead>
                            <tr>
                                <th>领取时间</th>
                                <th>奖励奖品</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- <tr>
                                <td>2020年11月12日00：00：00</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>2020年11月12日00：00：00</td>
                                <td>100</td>
                            </tr>
                            <tr>
                                <td>2020年11月12日00：00：00</td>
                                <td>100</td>
                            </tr> -->
                        </tbody>
                    </table>
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                          <!-- <li>
                            <a href="#" aria-label="Previous">
                              <span aria-hidden="true">&laquo;</span>
                            </a>
                          </li>
                          <li><a class="page-active" href="#">1</a></li>
                          <li><a href="#">2</a></li>
                          <li><a href="#">3</a></li>
                          <li><a href="#">4</a></li>
                          <li><a href="#">5</a></li>
                          <li><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li> -->
                        </ul>
                      </nav>
                </div>
            </div>
        </div>
        <div class="vitality-title"><img src="/style/img/promotion/vitality/vitality_active.png" alt=""></div>
        <div class="vitality-actives">
            <p>活动时间2021年2月10日0点至13日23：59：59</p>
            <p>活动内容：</p>
            <p>1.2月1日前所有累计存款1000元有效会员均可参加，每轮限时抢红包8888 个，每人每轮只可参与1次，每日最多可参与两次，每轮必出一台iPhone12手机</p>
            <p>2.领取方式
                <br>电脑版：登录账号【点击热门活动】-【新春红包】-【点击红包】
                <br>手机版：登录账号 点击右下角【我的】-【优惠领取】-【新春红包】</p>
            <table>
                <thead>
                    <tr>
                        <th>抢红包时间</th>
                        <th>游戏场馆</th>
                        <th>红包流水</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>第一轮（每日17:00点）</td>
                        <td rowspan="2">所有场馆</td>
                        <td rowspan="2">3倍</td>
                    </tr>
                    <tr>
                        <td>第二轮（每日20:00点）</td>
                    </tr>  
                </tbody>
            </table>
        </div>
        <div class="vitality-title"><img src="/style/img/promotion/vitality/vitality_ruler.png" alt=""></div>
        <div class="vitality-ruler">     
            <p>1：新春红包活动将派发500万现金红包，每天分别两个时间段开启限时抢红包，红包金额为8-18888随机不等，每日开放两轮；</p>
            <p>2：所有在2月1号前注册且存款≥1000的有效会员均可参与新春抢红包活动；</p>
            <p>3：每轮抢红包有效时间为1个小时内抢完为止，每轮开启1个小时后，红包自动关闭等待下一轮新春抢红包；</p>
            <p>4：红包奖金可进行东赢平台所有场馆游戏，3倍流水即可提款；</p>
            <p>5：此优惠促销只适用于拥有一个独立账户的玩家。住址、电子邮箱地址、电话号码、支付方式（相同借记卡/信用卡/银行账户号码）IP地址、同一网络环境等将可以作为判定是否独立玩家的条件。</p>
            <p>6：对于发现任何有违背、欺骗、或利用规则和条款进行非法获利的会员，东赢电竞乐保留在任何时候都可以停止、取消优惠或索回已支付的全部优惠的权利。</p>
            <p>7：东赢电竞有权延长、缩短、终止，或者修改此活动！此活动最终解释权归东赢电竞所有。</p>
        </div>
    </div>
</div>
<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bs-example-modal-lg">体育包赔申请</button> -->
@@include('right-side.html')
@@include('footer.html')
</body>
@@include('html-foot.html')
<script type="text/javascript">
var userExist = wap_is_user_notexist();
    $(function() {
        if(userExist) {
            info('请登录后操作')
            return;
        }
        var page ='1';//页数  
        var alertFlag =false;  
        bagStatus()
        record(page)
        // 红包状态接口
        setInterval(() => {
            bagStatus();
        }, 30000);
        // 红包状态显示接口
        function bagStatus(){
            $.ajax({
                dataType:'jsonp',
                url:event_site_host() +"/ptweb/event/springRedPacketState",
                data:{'token': wap_get_user().token},
                type:"GET",
                dataType: 'json',
                success:function(d){
                    if(d.openTime=='0'){//正在进行
                        $('.vitality-count').html('抢红包正在进行中')         
                    }else if(d.openTime=='-1'){//当前活动已结束
                        $('.vitality-count').html(d.msg);
                    }else if(d.openTime=='-2'){
                        $('.vitality-count').html(d.msg);
                    }else{//返回时间格式，进行倒计时
                        countDown(d.openTime,d.current)
                    }
                    if(d.success==true){
                        if(d.openTime=='0'){//success==true和openTime==0时才能抢红包
                            $('.red-top').click(function(){
                                if(alertFlag==false){
                                    getPackge();
                                    alertFlag=true;
                                    setTimeout(() => {
                                        alertFlag=false;
                                    },3000);
                                }     
                            })            
                        }                          
                    }else{
                        $('.red-top').click(function(){
                            if(alertFlag==false){
                                info(d.msg);
                                alertFlag=true;
                                setTimeout(() => {
                                    alertFlag=false;
                                },3000);
                            }  
                        })  
                    }
                }
            })
        };
        // 领奖记录
        function record(page){
            $.ajax({
                dataType:'jsonp',
                // event_site_host() +
                url: event_site_host() +"/ptweb/event/springRedPacketRecord",
                data:{'token': wap_get_user().token,'page':page},
                type:"GET",
                dataType: 'json',
                success:function(d){
                    var recordData =JSON.parse(d.data);
                    // var recordData= [{"amount":9999,"createTime":"2021-01-14 20:17:12","item":"新春大礼，IPHONE 12", }];
                    var html='';
                    $('.draw-record tbody').html(''); 
                    var pageNumber;
                    pageNumber=d.totalPage;       
                    if(d.success==true){
                        if(recordData.length>0){
                            recordData.forEach(function(o,i){
                                $('.draw-record tbody').append(`<tr><td>${o.createTime}</td><td>${o.itemId === 1 ? (o.item + o.amount) : o.item}</td>`);
                                $('.draw-record tbody').append(html);
                            })
                        }else{
                            html = `<tr><td colspan='2' style="text-align:center">暂无数据</td></tr>`;
                            $('.draw-record tbody').append(html);
                        }
                        var prevHtml=`<li><a class="prev"  aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>`;
                        var nextHtml=`<li><a class="next" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>`;
                        $('.pagination').html('');
                        var pageHeml='';
                        $('.pagination').html()
                        if(pageNumber>0){
                            $('.pagination').append(prevHtml);
                            for (num = 0; num < pageNumber; num++) { 
                                pageHeml=`<li><a>${num + 1}</a></li>`;
                                $('.pagination').append(pageHeml);
                            }
                            $('.pagination').append(nextHtml);
                            var startPage = page;//初始页
                            var currentPage =parseInt(page)+ 1;//当前页
                            $('.pagination>li:nth-child('+currentPage+')').find('a').addClass('page-active');
                            $('.pagination>li>a').click(function(){
                                page = parseInt($(this).html());
                                if(page>0){
                                    record(page);
                                    currentPage = page;//当前页
                                    startPage = currentPage;//初始页=当前页
                                    $('.pagination>li:nth-child('+currentPage+')').find('a').addClass('page-active');
                                }
                                
                                if(isNaN(page)){
                                    page = parseInt(startPage);
                                }
                            })
                            // 上一页
                            $('.prev').click(function(){
                                page = page - 1;
                                if(page>0){
                                    record(page);
                                    currentPage = page;
                                    $('.pagination>li:nth-child('+currentPage+')').find('a').addClass('page-active');
                                }
                            })
                            // 下一页
                            $('.next').click(function(){
                                page = page + 1; 
                                if(page<=pageNumber){
                                    record(page);
                                    currentPage = page;
                                    $('.pagination>li:nth-child('+currentPage+')').find('a').addClass('page-active');
                                }
                            })
                        }

                    }else{
                        info(d.msg);
                    }
                }
            }) 
        };
        // 倒计时显示
        function countDown(robTime,updateTime){
            var starttime = new Date(robTime);//开始时间 后台提供
            var nowtime = new Date(updateTime);//当前时间 后台提供
            var time = starttime - nowtime;
            var setTime = setInterval(function () {
                $('.vitality-count').html('')
                if(time<0){
                    $('.vitality-count').html('本轮红包已结束');
                    clearInterval(setTime);
                    return;
                }
                var day = parseInt(time / 1000 / 60 / 60 / 24);
                var hour = parseInt(time / 1000 / 60 / 60 % 24);
                var minute = parseInt(time / 1000 / 60 % 60);
                var seconds = parseInt(time / 1000 % 60);
                var countHtml='';
                if(day<10){
                    day= '0'+day;
                }
                if(hour<10){
                    hour = '0'+hour;
                }
                if(minute<10){
                    minute= '0'+minute;
                }
                if(seconds<10){
                    seconds= '0'+ seconds;
                }
                // 小于一天才显示倒计时
                if(day<1){
                    countHtml =`<span>${day}</span><b>日</b><span>${hour}</span><b>时</b><span>${minute}</span><b>分</b><span>${seconds}</span><b>秒</b>`;
                    $('.vitality-count').html(countHtml);
                    time = time - 1000;//当前倒计时减1000毫秒 
                }else{
                    clearInterval(setTime);//停止计时器
                    countHtml =`<span>${day}</span><b>日</b><span>${hour}</span><b>时</b><span>${minute}</span><b>分</b><span>${seconds}</span><b>秒</b>`;
                    $('.vitality-count').html(countHtml);
                }          
            }, 1000);  
        };
        var $timer;
        var $arr = ['8元','59元','66元','88元','95元'];
        // 抢红包接口
        function getPackge(){
            $.ajax({
                dataType:'jsonp',
                url:event_site_host() + "/ptweb/event/getSpringRedPacket",
                data:{'token': wap_get_user().token},
                type:"GET",
                dataType: 'json',
                success:function(d){
                    if(d.success==true){  
                        content();
                        $('.red-top').attr('src','/style/img/promotion/vitality/bag_open.png');
                        $('.row-gift').show();
                        $('.red-money').show()             
                        setTimeout(function(){
                            clearInterval($timer);
                            if(d.item=='IPHONE12'){
                                $('.red-money').text(d.item);
                                info('恭喜您抽中iPhone12手机一部，感谢您对东瀛的支持');
                            }else{
                                $('.red-money').text(d.amount+'元');
                                info('恭喜您获得'+d.amount+'元红包，祝您“牛”气冲天')
                            }
                        },5000);           
                    }else{
                        info(d.msg)
                    }
                }
            })
        };
        function Random(x, y) {
            return parseInt(Math.random() * (x - y + 1) + y);
        };
        function content() {
            $timer = setInterval(function() {
                $(".red-money").text($arr[Random(-1, 6)]);
            }, 250);
        };
    });
</script>
</html>
